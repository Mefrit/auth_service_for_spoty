{"version":3,"sources":["Search.ts"],"names":[],"mappings":"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","file":"../Search.js","sourcesContent":["import { PlayList } from \"./modules/PlayList\";\r\nimport { AudioPlayer } from \"./modules/AudioPlayer\";\r\nimport { Api } from \"./modules/Api\";\r\nimport { settings } from \"./settings\";\r\nimport { setUserInfoFromStorage } from \"./lib/reqistration\";\r\nimport {\r\n    userInfoDom,\r\n    searchBtn,\r\n    albumsContent,\r\n    audioPlayer,\r\n    songInfoPlayer,\r\n    playPause,\r\n    playBack,\r\n    playForward,\r\n    playProgress,\r\n    playSoundMute,\r\n    playVolume,\r\n    playTimeStart,\r\n    playSvgPath,\r\n    playTimeEnd,\r\n    songs,\r\n    playsBtn,\r\n    searchStringDom,\r\n    registrationLink,\r\n} from \"./lib/domInit\";\r\nimport { SettingsInterface, PlayerInterfaceInput, DefaultRequest } from \"./interfaces/DefaultInterface\";\r\nimport { SearchInterface } from \"./interfaces/SearchInterface\";\r\nimport { ApiInterface } from \"./interfaces/ApiInterface\";\r\n\r\nclass Search {\r\n    userInfoDom: HTMLElement;\r\n    songsDom: HTMLElement;\r\n    Api: ApiInterface;\r\n    player: PlayerInterfaceInput;\r\n    albumsContent: HTMLElement;\r\n    settings: SettingsInterface;\r\n    search_string: string;\r\n    searchBtn: HTMLElement;\r\n    searchStringDom: HTMLElement;\r\n    playsBtn: HTMLCollection;\r\n    search_mode: string;\r\n    constructor(conf: SearchInterface) {\r\n        this.userInfoDom = conf.userInfoDom;\r\n        this.songsDom = conf.songs;\r\n        this.searchStringDom = conf.searchStringDom;\r\n        this.searchBtn = conf.searchBtn;\r\n\r\n        this.Api = conf.api;\r\n        this.player = conf.player;\r\n        this.settings = conf.settings;\r\n        this.playsBtn = conf.playsBtn;\r\n        this.albumsContent = conf.albumsContent;\r\n        this.search_mode = \"name_song\";\r\n        this.search_string = \"\";\r\n    }\r\n    playMusic = (ev: Event) => {\r\n        if (ev.target) {\r\n            const el = ev.target as HTMLInputElement;\r\n            const songSetting = el.getAttribute(\"data-info-music\");\r\n            if (songSetting) {\r\n                const songData = JSON.parse(songSetting);\r\n                this.player.play(songData);\r\n            }\r\n        }\r\n    };\r\n    createBackLink() {\r\n        return \"<a href='/'>Назад</a>\";\r\n    }\r\n    initPlaySongEvents() {\r\n        // вынести\r\n\r\n        if (this.playsBtn) {\r\n            for (var i = 0; i < this.playsBtn.length; i++) {\r\n                this.playsBtn[i].addEventListener(\"click\", this.playMusic);\r\n            }\r\n        }\r\n    }\r\n    startSearch = () => {\r\n        const value = (this.searchStringDom as HTMLInputElement).value;\r\n        const url_search =\r\n            `https://api.jamendo.com/v3.0/tracks/?client_id=${this.settings.CLIENT_ID}&format=jsonpretty&limit=40&search=` +\r\n            value.trim();\r\n        this.albumsContent.innerHTML = \"<p>Поиск...</p>\";\r\n        this.Api.getDataFromApi(url_search).then((data: DefaultRequest) => {\r\n            this.albumsContent.innerHTML = \"\";\r\n            const playlist = new PlayList({\r\n                list: data.data,\r\n                title: \"Найденные композиции\",\r\n                type: \"track\",\r\n                url: url_search,\r\n            });\r\n            this.albumsContent.insertAdjacentHTML(\"beforeend\", playlist.render());\r\n            const playsBtn = document.getElementsByClassName(\"play-btn\");\r\n            this.initListenMusicEvent(playsBtn);\r\n        });\r\n    };\r\n    initListenMusicEvent(playsBtn: HTMLCollection) {\r\n        if (playsBtn) {\r\n            for (var i = 0; i < playsBtn.length; i++) {\r\n                playsBtn[i].addEventListener(\"click\", this.playMusic);\r\n            }\r\n        }\r\n    }\r\n    initSearchEvents() {\r\n        this.searchBtn.addEventListener(\"click\", this.startSearch);\r\n        this.searchStringDom.addEventListener(\"keydown\", (event) => {\r\n            if (event.keyCode == 13) {\r\n                event.preventDefault();\r\n                this.startSearch();\r\n            }\r\n        });\r\n    }\r\n    setRegistrationLink() {\r\n        registrationLink?.setAttribute(\r\n            \"href\",\r\n            `https://api.jamendo.com/v3.0/oauth/authorize?client_id=${this.settings.CLIENT_ID}&redirect_uri=http://localhost:4567/&response_type=code`\r\n        );\r\n    }\r\n    async init() {\r\n        // вход\r\n\r\n        this.setRegistrationLink();\r\n        if (localStorage.getItem(\"accessToken\") !== \"undefined\") {\r\n            setUserInfoFromStorage(userInfoDom, registrationLink);\r\n        }\r\n        this.initSearchEvents();\r\n    }\r\n    start() {\r\n        this.init();\r\n    }\r\n}\r\n\r\nconst ApiObject: ApiInterface = new Api();\r\n\r\nconst player = new AudioPlayer({\r\n    audioPlayer: audioPlayer,\r\n    api: ApiObject,\r\n    settings: settings,\r\n    songInfoPlayer: songInfoPlayer,\r\n    playPause: playPause,\r\n    playBack: playBack,\r\n    playForward: playForward,\r\n    playProgress: playProgress,\r\n    playVolume: playVolume,\r\n    playSoundMute: playSoundMute,\r\n    timeStart: playTimeStart,\r\n    timeEnd: playTimeEnd,\r\n    playSvgPath: playSvgPath,\r\n});\r\n\r\nconst main = new Search({\r\n    userInfoDom: userInfoDom,\r\n    songs: songs,\r\n    api: ApiObject,\r\n    player: player,\r\n    settings: settings,\r\n    songInfoPlayer: songInfoPlayer,\r\n    searchStringDom: searchStringDom,\r\n    searchBtn: searchBtn,\r\n    albumsContent: albumsContent,\r\n    playsBtn: playsBtn,\r\n});\r\nmain.init();\r\n"]}