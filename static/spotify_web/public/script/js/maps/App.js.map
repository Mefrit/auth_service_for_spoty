{"version":3,"sources":["App.ts"],"names":[],"mappings":"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","file":"../App.js","sourcesContent":["import { postJSON, getParams, getCurentUserInfo, getDataFromApi } from \"./lib/query\";\r\nimport { PlayList } from \"./modules/PlayList\";\r\nimport { AudioPlayer } from \"./modules/AudioPlayer\";\r\nimport { Api } from \"./modules/Api\";\r\nimport { settings } from \"./settings\";\r\n\r\nimport {\r\n    userInfoDom,\r\n    playsBtn,\r\n    albumsContent,\r\n    audioPlayer,\r\n    songInfoPlayer,\r\n    playPause,\r\n    playBack,\r\n    playForward,\r\n    playProgress,\r\n    playSoundMute,\r\n    playVolume,\r\n    playTimeStart,\r\n    playSvgPath,\r\n    playTimeEnd,\r\n    registrationLink,\r\n} from \"./lib/domInit\";\r\n\r\nimport {\r\n    SettingsInterface,\r\n    GetUserInfoInterface,\r\n    PlayerInterfaceInput,\r\n    DefaultRequest,\r\n} from \"./interfaces/defaultInterface\";\r\nimport { MainPageInterface } from \"./interfaces/MainpageInterface\";\r\nlet tokenInfo: { accessToken: string } = { accessToken: \"\" };\r\n\r\nfunction getTemplateForUserInfo(userInfo: { image: string; dispname: string }) {\r\n    return `\r\n        <div class=\"user-info\">\r\n            <img src=\"${userInfo.image}\"alt=\"image_profile\">\r\n            <span>${userInfo.dispname}</span>\r\n        </div>\r\n    `;\r\n}\r\n\r\nclass MainPage {\r\n    userInfoDom: HTMLElement;\r\n    albumsContent: HTMLElement;\r\n\r\n    player: PlayerInterfaceInput;\r\n\r\n    registrationLink: HTMLElement;\r\n    settings: SettingsInterface;\r\n    playsBtn: HTMLCollection;\r\n    constructor(conf: MainPageInterface) {\r\n        this.userInfoDom = conf.userInfoDom;\r\n        this.albumsContent = conf.albumsContent;\r\n        this.registrationLink = conf.registrationLink;\r\n\r\n        this.player = conf.player;\r\n        this.settings = conf.settings;\r\n        this.playsBtn = conf.playsBtn;\r\n    }\r\n\r\n    playMusic = (ev: Event) => {\r\n        ev.preventDefault();\r\n        if (ev.target) {\r\n            const el = ev.target as HTMLInputElement;\r\n            const songSetting = el.getAttribute(\"data-info-music\");\r\n            if (songSetting) {\r\n                const songData = JSON.parse(songSetting);\r\n                if (this.player.play) this.player.play(songData);\r\n            }\r\n        }\r\n    };\r\n    async init() {\r\n        // вход\r\n\r\n        this.registrationLink.setAttribute(\r\n            \"href\",\r\n            `https://api.jamendo.com/v3.0/oauth/authorize?client_id=${this.settings.clientId}&redirect_uri=http://localhost:4567/&response_type=code`\r\n        );\r\n        if (this.albumsContent) {\r\n            // fuzzytags - выбор по тегам\r\n            let url, playlist;\r\n\r\n            // новинки\r\n            url = `https://api.jamendo.com/v3.0/playlists/?client_id=${this.settings.clientId}&format=jsonpretty&limit=12&datebetween=2022-01-02_2022-04-01&hasimage=1`;\r\n            const albums: DefaultRequest = await getDataFromApi(url);\r\n            if (albums.result) {\r\n                playlist = new PlayList({ list: albums.data, title: \"Плейлисты\", type: \"playlist\", url: url });\r\n                this.albumsContent.insertAdjacentHTML(\"beforeend\", playlist.render());\r\n            }\r\n\r\n            /// afhnbcns\r\n            const urlArtist = `https://api.jamendo.com/v3.0/artists/?client_id=${this.settings.clientId}&format=jsonpretty&limit=12&imagesize=100`;\r\n            const albumsArtist: DefaultRequest = await getDataFromApi(urlArtist);\r\n\r\n            playlist = new PlayList({\r\n                list: albumsArtist.data,\r\n                title: \"Исполнители\",\r\n                type: \"artist\",\r\n                url: urlArtist,\r\n            });\r\n            this.albumsContent.insertAdjacentHTML(\"beforeend\", playlist.render());\r\n            // по жанрам\r\n            // артисты\r\n            const urlTop = `https://api.jamendo.com/v3.0/tracks/?client_id=${this.settings.clientId}&format=jsonpretty&limit=12&include=musicinfo&boost=listens_week&imagesize=100`;\r\n            const trackTop: DefaultRequest = await getDataFromApi(urlTop);\r\n\r\n            playlist = new PlayList({ list: trackTop.data, title: \"Новинки недели\", type: \"track\", url: urlTop });\r\n            this.albumsContent.insertAdjacentHTML(\"beforeend\", playlist.render());\r\n\r\n            const urlJenre = `https://api.jamendo.com/v3.0/playlists/?client_id=${this.settings.clientId}&format=jsonpretty&limit=12`;\r\n            const albumsJenre: DefaultRequest = await getDataFromApi(urlJenre);\r\n            playlist = new PlayList({ list: albumsJenre.data, title: \"Жанры\", type: \"playlist\", url: urlJenre });\r\n            this.albumsContent.insertAdjacentHTML(\"beforeend\", playlist.render());\r\n        }\r\n\r\n        if (this.playsBtn) {\r\n            for (var i = 0; i < this.playsBtn.length; i++) {\r\n                playsBtn[i].addEventListener(\"click\", this.playMusic);\r\n            }\r\n        }\r\n    }\r\n    start() {\r\n        this.init();\r\n    }\r\n}\r\nconst urlParams = getParams(window.location);\r\n\r\nif (urlParams.code && !tokenInfo.accessToken && !localStorage.getItem(\"accessToken\")) {\r\n    postJSON(\"/\", {\r\n        code: urlParams.code,\r\n    }).then(async (answer) => {\r\n        const parsedToken = JSON.parse(answer.accessToken);\r\n        if (parsedToken.error) {\r\n            alert(\"ERROR =>\" + parsedToken.error_description);\r\n        } else {\r\n            registrationLink.style.display = \"none\";\r\n            localStorage.setItem(\"accessToken\", parsedToken.access_token);\r\n            localStorage.setItem(\"timeSetAccessToken\", new Date().getTime().toString());\r\n            tokenInfo = parsedToken.access_token;\r\n            const userInfo: GetUserInfoInterface = await getCurentUserInfo(parsedToken.access_token);\r\n\r\n            if (userInfoDom && userInfo.result) {\r\n                localStorage.setItem(\"id_user\", userInfo.user.id);\r\n                const userInfoContent = getTemplateForUserInfo(userInfo.user);\r\n                userInfoDom.insertAdjacentHTML(\"beforeend\", userInfoContent);\r\n            } else {\r\n                alert(userInfo.message);\r\n            }\r\n        }\r\n    });\r\n} else {\r\n    if (localStorage.getItem(\"accessToken\") !== \"undefined\") {\r\n        const timeSetAccessToken = Number(localStorage.getItem(\"timeSetAccessToken\"));\r\n        const dateSetToken: Date = new Date(timeSetAccessToken);\r\n        const curentDate: Date = new Date();\r\n        if (curentDate.getTime() - dateSetToken.getTime() > 5000000) {\r\n            localStorage.removeItem(\"timeSetAccessToken\");\r\n            localStorage.removeItem(\"accessToken\");\r\n        } else {\r\n            const tokenFromStorage = localStorage.getItem(\"accessToken\");\r\n            if (tokenFromStorage) {\r\n                tokenInfo = { accessToken: tokenFromStorage };\r\n                getCurentUserInfo(tokenInfo.accessToken).then((userInfo: GetUserInfoInterface) => {\r\n                    if (userInfo.result) {\r\n                        localStorage.setItem(\"id_user\", userInfo.user.id);\r\n                        registrationLink.style.display = \"none\";\r\n                        if (userInfoDom) {\r\n                            const userInfoContent = getTemplateForUserInfo(userInfo.user);\r\n                            userInfoDom.insertAdjacentHTML(\"beforeend\", userInfoContent);\r\n                        } else {\r\n                            alert(\"Error: \" + userInfo.message);\r\n                        }\r\n                    } else {\r\n                        alert(userInfo.message);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst ApiObject = new Api();\r\nconst player = new AudioPlayer({\r\n    audioPlayer: audioPlayer,\r\n    api: ApiObject,\r\n    settings: settings,\r\n    songInfoPlayer: songInfoPlayer,\r\n    playPause: playPause,\r\n    playBack: playBack,\r\n    playForward: playForward,\r\n    playProgress: playProgress,\r\n    playVolume: playVolume,\r\n    playSoundMute: playSoundMute,\r\n    timeStart: playTimeStart,\r\n    timeEnd: playTimeEnd,\r\n    playSvgPath: playSvgPath,\r\n});\r\nconst main = new MainPage({\r\n    userInfoDom: userInfoDom,\r\n    albumsContent: albumsContent,\r\n\r\n    player: player,\r\n    settings: settings,\r\n    songInfoPlayer: songInfoPlayer,\r\n    registrationLink: registrationLink,\r\n    playsBtn: playsBtn,\r\n});\r\nmain.start();\r\n"]}