{"version":3,"sources":["modules/AudioPlayer.ts"],"names":[],"mappings":"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","file":"../../modules/AudioPlayer.js","sourcesContent":["import { SongInfoPlayer } from \"./SongInfoPlayer\";\r\nexport class AudioPlayer {\r\n    dom_audioPlayer: any;\r\n    Api: any;\r\n    songInfoPlayer: any;\r\n    settings: any;\r\n    playBack: HTMLElement;\r\n    playForward: HTMLElement;\r\n    playProgress: HTMLElement | any;\r\n    playVolume: HTMLElement;\r\n    playSoundMute: HTMLElement;\r\n    playPause: HTMLElement;\r\n    is_played: boolean;\r\n    curent_song_index: number;\r\n    curent_api_url: string;\r\n    play_timeStart: HTMLElement;\r\n    playSvgPath: HTMLElement;\r\n    play_timeEnd: HTMLElement;\r\n    curent_volume: number;\r\n    constructor(conf: any) {\r\n        this.is_played = false;\r\n        this.dom_audioPlayer = conf.audioPlayer;\r\n        this.curent_volume = 50;\r\n        this.curent_song_index = 0;\r\n        this.curent_api_url = \"\";\r\n\r\n        this.Api = conf.api;\r\n        this.settings = conf.settings;\r\n        this.songInfoPlayer = conf.songInfoPlayer;\r\n        this.playBack = conf.playBack;\r\n        this.playForward = conf.playForward;\r\n        this.playProgress = conf.playProgress;\r\n        this.playVolume = conf.playVolume;\r\n        this.playPause = conf.playPause;\r\n        this.playSoundMute = conf.playSoundMute;\r\n        this.play_timeStart = conf.timeStart;\r\n        this.play_timeEnd = conf.timeEnd;\r\n        this.playSvgPath = conf.playSvgPath;\r\n        this.initEvents();\r\n    }\r\n    getTimeFromSecunds(sec: number) {\r\n        const full_minutes = Math.round(sec / 60);\r\n        const secunds = Math.abs(Math.round(sec - full_minutes * 60));\r\n        return (\"0\" + full_minutes).slice(-2) + \":\" + (\"0\" + secunds).slice(-2);\r\n    }\r\n    timeupdate = () => {\r\n        const current_time = this.dom_audioPlayer.currentTime;\r\n        const duration = this.dom_audioPlayer.duration;\r\n\r\n        this.play_timeStart.innerHTML = this.getTimeFromSecunds(current_time + 0.25);\r\n\r\n        this.play_timeEnd.innerHTML = this.getTimeFromSecunds(duration);\r\n        this.playProgress.value = Math.round(((current_time + 0.25) / duration) * 100);\r\n    };\r\n    changePlayProgress = (ev: any) => {\r\n        const new_part = ev.target.value;\r\n        const duration = this.dom_audioPlayer.duration;\r\n        this.dom_audioPlayer.currentTime = Math.round((duration / 100) * new_part);\r\n    };\r\n    muteSound = () => {\r\n        if (this.dom_audioPlayer.volume === 0) {\r\n            this.dom_audioPlayer.volume = this.curent_volume / 100;\r\n        } else {\r\n            this.dom_audioPlayer.volume = 0;\r\n        }\r\n    };\r\n    playPauseSong = () => {\r\n        if (this.is_played) {\r\n            this.playSvgPath.setAttribute(\r\n                \"d\",\r\n                \"M3 1.713a.7.7 0 011.05-.607l10.89 6.288a.7.7 0 010 1.212L4.05 14.894A.7.7 0 013 14.288V1.713z\"\r\n            );\r\n            this.dom_audioPlayer.pause();\r\n        } else {\r\n            this.playSvgPath.setAttribute(\"d\", \"M0,0 0,16 5,16 5,0z M 15,0 15,16 10,16 10,0z\");\r\n            this.dom_audioPlayer.play();\r\n        }\r\n        this.is_played = !this.is_played;\r\n    };\r\n    playForward = () => {\r\n        this.dom_audioPlayer.pause();\r\n\r\n        if (this.curent_api_url)\r\n            this.Api.getDataFromApi(this.curent_api_url).then((answer: any) => {\r\n                if (answer.result) {\r\n                    const start_tracks = answer.data[0].tracks ? answer.data[0].tracks : answer.data;\r\n\r\n                    const track = start_tracks.filter((elem: any) => {\r\n                        return elem.audio !== \"\";\r\n                    });\r\n                    if (track.length > 0) {\r\n                        if (this.curent_song_index + 1 >= track.length) {\r\n                            this.curent_song_index = 0;\r\n                        } else {\r\n                            this.curent_song_index++;\r\n                        }\r\n\r\n                        this.playSong(track[this.curent_song_index]);\r\n                    }\r\n                }\r\n            });\r\n        this.is_played = !this.is_played;\r\n    };\r\n    playBack = () => {\r\n        this.dom_audioPlayer.pause();\r\n\r\n        if (this.curent_api_url)\r\n            this.Api.getDataFromApi(this.curent_api_url).then((answer: any) => {\r\n                if (answer.result) {\r\n                    const start_tracks = answer.data[0].tracks ? answer.data[0].tracks : answer.data;\r\n                    if (start_tracks.length > 0) {\r\n                        if (this.curent_song_index - 1 < 0) {\r\n                            this.curent_song_index = start_tracks.length - 1;\r\n                        } else {\r\n                            this.curent_song_index--;\r\n                        }\r\n                        this.playSong(start_tracks[this.curent_song_index]);\r\n                    }\r\n                }\r\n            });\r\n        this.is_played = !this.is_played;\r\n    };\r\n    initEvents() {\r\n        this.dom_audioPlayer.addEventListener(\"timeupdate\", this.timeupdate);\r\n        this.playProgress.addEventListener(\"change\", this.changePlayProgress);\r\n        this.playSoundMute.addEventListener(\"click\", this.muteSound);\r\n        this.playVolume.addEventListener(\"change\", (ev: any) => {\r\n            this.curent_volume = ev.target.value;\r\n            this.dom_audioPlayer.volume = ev.target.value / 100;\r\n        });\r\n        this.playPause.addEventListener(\"click\", this.playPauseSong);\r\n        this.playForward.addEventListener(\"click\", this.playForward);\r\n        this.playBack.addEventListener(\"click\", this.playBack);\r\n    }\r\n\r\n    playSong(data: any) {\r\n        this.songInfoPlayer.innerHTML = \"\";\r\n        this.dom_audioPlayer.setAttribute(\"src\", data.audio);\r\n        this.dom_audioPlayer.play();\r\n        this.is_played = true;\r\n        const song_info = new SongInfoPlayer(data);\r\n        this.songInfoPlayer.insertAdjacentHTML(\"beforeend\", song_info.render());\r\n    }\r\n    loadArtistSong(artist_id: any) {\r\n        const params = new URLSearchParams({\r\n            artist_id: artist_id,\r\n            mode: \"artist\",\r\n        });\r\n        document.location.href = \"play?\" + params.toString();\r\n    }\r\n    loadPlayList(playListId: string) {\r\n        const params = new URLSearchParams({\r\n            playListId: playListId,\r\n            mode: \"playlist\",\r\n        });\r\n        document.location.href = \"play?\" + params.toString();\r\n    }\r\n    loadAlbumSong(album_id: string) {\r\n        const params = new URLSearchParams({\r\n            album_id: album_id,\r\n            mode: \"album\",\r\n        });\r\n        document.location.href = \"play?\" + params.toString();\r\n    }\r\n    async play(data: any) {\r\n        let answer: any;\r\n        if (data) {\r\n            this.curent_api_url = data.url;\r\n            this.curent_song_index = data.index;\r\n            if (data.isPlaylist) {\r\n                await this.loadPlayList(data.id);\r\n            }\r\n            if (data.isArtist) {\r\n                await this.loadArtistSong(data.id);\r\n            }\r\n            if (data.isAlbum) {\r\n                await this.loadAlbumSong(data.id);\r\n            }\r\n            answer = await this.Api.loadSong(data.id, this.settings.clientId);\r\n\r\n            if (answer.result && answer.data.length > 0) {\r\n                this.playSvgPath.setAttribute(\"d\", \"M0,0 0,16 5,16 5,0z M 15,0 15,16 10,16 10,0z\");\r\n                this.playSong(answer.data[0]);\r\n            } else {\r\n                this.dom_audioPlayer.pause();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}