{"version":3,"sources":["lib/reqistration.ts"],"names":[],"mappings":";;;;IAIA,SAAgB,sBAAsB,CAAC,QAA6C;QAChF,OAAO,sEAEa,QAAQ,CAAC,KAAK,yDAClB,QAAQ,CAAC,QAAQ,kCAEhC,CAAC;IACN,CAAC;IAPD,wDAOC;IACD,SAAgB,sBAAsB,CAAC,WAAwB,EAAE,gBAA6B;QAC1F,IAAM,kBAAkB,GAAG,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,oBAAoB,CAAC,CAAC,CAAC;QAC9E,IAAM,YAAY,GAAS,IAAI,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACxD,IAAM,UAAU,GAAS,IAAI,IAAI,EAAE,CAAC;QAEpC,IAAI,UAAU,CAAC,OAAO,EAAE,GAAG,YAAY,CAAC,OAAO,EAAE,GAAG,mBAAQ,CAAC,aAAa,EAAE;YACxE,YAAY,CAAC,UAAU,CAAC,oBAAoB,CAAC,CAAC;YAC9C,YAAY,CAAC,UAAU,CAAC,aAAa,CAAC,CAAC;SAC1C;aAAM;YACH,IAAM,gBAAgB,GAAG,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;YAC7D,IAAI,gBAAgB,EAAE;gBAClB,IAAI,SAAS,GAAG,EAAE,WAAW,EAAE,gBAAgB,EAAE,CAAC;gBAClD,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;gBAChC,IAAA,yBAAiB,EAAC,SAAS,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAC,QAA8B;oBACzE,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;oBACtB,IAAI,QAAQ,CAAC,MAAM,EAAE;wBACjB,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;wBAClD,gBAAgB,CAAC,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC;wBACxC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;wBACzB,IAAI,WAAW,EAAE;4BACb,IAAM,eAAe,GAAG,sBAAsB,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;4BAC9D,WAAW,CAAC,kBAAkB,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC;yBAChE;6BAAM;4BACH,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;yBACvC;qBACJ;yBAAM;wBACH,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;qBAC3B;gBACL,CAAC,CAAC,CAAC;aACN;SACJ;IACL,CAAC;IA/BD,wDA+BC","file":"../../lib/reqistration.js","sourcesContent":["import { settings } from \"../settings\";\r\n\r\nimport { getCurentUserInfo } from \"./query\";\r\nimport { GetUserInfoInterface } from \"../interfaces/DefaultInterface\";\r\nexport function getTemplateForUserInfo(userInfo: { image: string; dispname: string }) {\r\n    return `\r\n        <div class=\"user-info\">\r\n            <img src=\"${userInfo.image}\"alt=\"image_profile\">\r\n            <span>${userInfo.dispname}</span>\r\n        </div>\r\n    `;\r\n}\r\nexport function setUserInfoFromStorage(userInfoDom: HTMLElement, registrationLink: HTMLElement) {\r\n    const timeSetAccessToken = Number(localStorage.getItem(\"timeSetAccessToken\"));\r\n    const dateSetToken: Date = new Date(timeSetAccessToken);\r\n    const curentDate: Date = new Date();\r\n\r\n    if (curentDate.getTime() - dateSetToken.getTime() > settings.TIME_TO_BLOCK) {\r\n        localStorage.removeItem(\"timeSetAccessToken\");\r\n        localStorage.removeItem(\"accessToken\");\r\n    } else {\r\n        const tokenFromStorage = localStorage.getItem(\"accessToken\");\r\n        if (tokenFromStorage) {\r\n            let tokenInfo = { accessToken: tokenFromStorage };\r\n            console.log(\"start\", tokenInfo);\r\n            getCurentUserInfo(tokenInfo.accessToken).then((userInfo: GetUserInfoInterface) => {\r\n                console.log(userInfo);\r\n                if (userInfo.result) {\r\n                    localStorage.setItem(\"id_user\", userInfo.user.id);\r\n                    registrationLink.style.display = \"none\";\r\n                    console.log(userInfoDom);\r\n                    if (userInfoDom) {\r\n                        const userInfoContent = getTemplateForUserInfo(userInfo.user);\r\n                        userInfoDom.insertAdjacentHTML(\"beforeend\", userInfoContent);\r\n                    } else {\r\n                        alert(\"Error: \" + userInfo.message);\r\n                    }\r\n                } else {\r\n                    alert(userInfo.message);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}